DROP TABLE IF EXISTS EvaluateurJury;
DROP TABLE IF EXISTS CompetiteurParticipe;
DROP TABLE IF EXISTS ClubParticipe;
DROP TABLE IF EXISTS Evaluation;
DROP TABLE IF EXISTS Dessin;
DROP TABLE IF EXISTS Concours;
DROP TABLE IF EXISTS Evaluateur;
DROP TABLE IF EXISTS Competiteur;
DROP TABLE IF EXISTS Directeur;
DROP TABLE IF EXISTS Administrateur;
DROP TABLE IF EXISTS Président;
DROP TABLE IF EXISTS Utilisateur;
DROP TABLE IF EXISTS Club;

/*Création des tables*/

CREATE TABLE Club (
    numClub INT PRIMARY KEY,
    nomClub VARCHAR(100) NOT NULL,
    adresse VARCHAR(255) NOT NULL,
    numTelephone VARCHAR(10),
    nombreAdherents INT,
    ville VARCHAR(100),
    département VARCHAR(100),
    région VARCHAR(100)
);

CREATE TABLE Utilisateur (
    numUtilisateur INT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    prénom VARCHAR(100) NOT NULL,
    adresse VARCHAR(255) NOT NULL,
    login VARCHAR(50) UNIQUE NOT NULL,
    motDePasse VARCHAR(255) NOT NULL,
    numClub INT,
    FOREIGN KEY (numClub) REFERENCES Club(numClub) ON DELETE SET NULL
);

CREATE TABLE Président (
    numPresident INT PRIMARY KEY,
    prime DECIMAL(10, 2),
    FOREIGN KEY (numPresident) REFERENCES Utilisateur(numUtilisateur) ON DELETE CASCADE
);

CREATE TABLE Administrateur (
    numAdministrateur INT PRIMARY KEY,
    dateDébut DATE NOT NULL,
    FOREIGN KEY (numAdministrateur) REFERENCES Utilisateur(numUtilisateur) ON DELETE CASCADE
);

CREATE TABLE Directeur (
    numDirecteur INT PRIMARY KEY,
    dateDébut DATE NOT NULL,
    numClub INT NOT NULL,
    FOREIGN KEY (numDirecteur) REFERENCES Utilisateur(numUtilisateur) ON DELETE CASCADE,
    FOREIGN KEY (numClub) REFERENCES Club(numClub) ON DELETE CASCADE
);

CREATE TABLE Concours (
    numConcours INT PRIMARY KEY,
    thème VARCHAR(100) NOT NULL,
    dateDébut DATE NOT NULL,
    dateFin DATE NOT NULL,
    état VARCHAR(50),
    numPresident INT NOT NULL,
    FOREIGN KEY (numPresident) REFERENCES Président(numPresident) ON DELETE CASCADE
);

CREATE TABLE Compétiteur (
    numCompétiteur INT PRIMARY KEY,
    datePremièreParticipation DATE,
    FOREIGN KEY (numCompétiteur) REFERENCES Utilisateur(numUtilisateur) ON DELETE CASCADE
);

CREATE TABLE Dessin (
    numDessin INT PRIMARY KEY,
    commentaire TEXT,
    classement INT,
    dateRemise DATE NOT NULL,
    leDessin BLOB,
    numConcours INT NOT NULL,
    numCompétiteur INT NOT NULL,
    FOREIGN KEY (numConcours) REFERENCES Concours(numConcours) ON DELETE CASCADE,
    FOREIGN KEY (numCompétiteur) REFERENCES Compétiteur(numCompétiteur) ON DELETE CASCADE
);

CREATE TABLE Evaluation (
    dateEvaluation DATE NOT NULL,
    note DECIMAL(5, 2) NOT NULL,
    commentaire TEXT,
    numDessin INT NOT NULL,
    numEvaluateur INT NOT NULL,
    PRIMARY KEY (dateEvaluation, numDessin, numEvaluateur),
    FOREIGN KEY (numDessin) REFERENCES Dessin(numDessin) ON DELETE CASCADE,
    FOREIGN KEY (numEvaluateur) REFERENCES Evaluateur(numEvaluateur) ON DELETE CASCADE
);

CREATE TABLE Evaluateur (
    numEvaluateur INT PRIMARY KEY,
    spécialité VARCHAR(100),
    FOREIGN KEY (numEvaluateur) REFERENCES Utilisateur(numUtilisateur) ON DELETE CASCADE
);

CREATE TABLE ClubParticipe (
    numClub INT NOT NULL,
    numConcours INT NOT NULL,
    PRIMARY KEY (numClub, numConcours),
    FOREIGN KEY (numClub) REFERENCES Club(numClub) ON DELETE CASCADE,
    FOREIGN KEY (numConcours) REFERENCES Concours(numConcours) ON DELETE CASCADE
);

CREATE TABLE CompétiteurParticipe (
    numConcours INT NOT NULL,
    numCompétiteur INT NOT NULL,
    PRIMARY KEY (numConcours, numCompétiteur),
    FOREIGN KEY (numConcours) REFERENCES Concours(numConcours) ON DELETE CASCADE,
    FOREIGN KEY (numCompétiteur) REFERENCES Compétiteur(numCompétiteur) ON DELETE CASCADE
);

CREATE TABLE EvaluateurJury (
    numConcours INT NOT NULL,
    numEvaluateur INT NOT NULL,
    PRIMARY KEY (numConcours, numEvaluateur),
    FOREIGN KEY (numConcours) REFERENCES Concours(numConcours) ON DELETE CASCADE,
    FOREIGN KEY (numEvaluateur) REFERENCES Evaluateur(numEvaluateur) ON DELETE CASCADE
);
